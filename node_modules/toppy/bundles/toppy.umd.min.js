!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("toppy",["exports","@angular/core","rxjs","rxjs/operators","@angular/common"],e):e(t.toppy={},t.ng.core,t.rxjs,t.rxjs.operators,t.ng.common)}(this,function(t,i,r,o,e){"use strict";var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function c(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,r=n.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(o=r.next()).done;)s.push(o.value)}catch(c){i={error:c}}finally{try{o&&!o.done&&(n=r["return"])&&n.call(r)}finally{if(i)throw i.error}}return s}var n={TOP:"t",LEFT:"l",RIGHT:"r",BOTTOM:"b",TOP_LEFT:"tl",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br"},h=a({},n,{LEFT_TOP:"lt",RIGHT_TOP:"rt",LEFT_BOTTOM:"lb",RIGHT_BOTTOM:"rb"}),l=a({},n,{CENTER:"c"}),u={LEFT:"l",RIGHT:"r"},f=function(){function t(){this.config={}}return t.prototype.getClassName=function(){return this.constructor.name.replace("Pos","-pos").toLowerCase()},t.prototype.updateConfig=function(t){this.config=a({},this.config,t)},t.prototype.init=function(t){},t}(),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.getPositions=function(){return{top:0,left:0,width:"100%",height:"100%",position:"fixed"}},e}(f);function g(t,e){void 0===e&&(e={});var n="c";return"string"==typeof t&&e.hasHTML?n="h":"string"==typeof t?n="s":t instanceof i.TemplateRef&&(n="t"),{data:t,type:n,props:e}}function y(){return Math.random().toString(36).substr(2,5)}function v(t,e,n){var o;void 0===n&&(n="body"),(o=document.querySelector(n).classList)[t].apply(o,function i(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}(e))}function m(e){return Object.keys(e).map(function(t){return t+":"+e[t]+("number"==typeof e[t]?"px":"")}).join(";")}function w(t,e,n,o){return"number"==typeof o&&(e[n]=o=Math.abs(o)),"string"==typeof o&&o.endsWith("%")&&(o=function i(t,e){var n=Number(e.slice(0,-1));return 100<n&&(n=100),"calc("+t+"px - "+(100-n)+"%)"}(t[n],o)),o}var b=document.querySelector("body"),C=new(function(){function t(){this._e=new r.Subject}return t.prototype.send=function(t,e,n){void 0===n&&(n=null),this._e.next({from:t,name:e,data:n})},t.prototype.listen=function(e,n){return this._e.asObservable().pipe(o.filter(function(t){return t.from===e&&t.name===n}),o.map(function(t){return t.data}))},t.prototype.stop=function(){this._e.complete()},t}()),O=function(n){function t(t){var e=n.call(this)||this;return e.config={placement:l.CENTER,width:100,height:100,offset:0},e.updateConfig(t),e}return c(t,n),t.prototype.getPositions=function(t){var e=t.getBoundingClientRect(),n={width:window.innerWidth,height:window.innerHeight},o=this.config,i=o.width,r=o.height;i=w(n,e,"width",i),r=w(n,e,"height",r);var s=this.calc(this.config.placement,n,e);return a({},s,{width:i,height:r,position:"fixed",extra:this.config.placement})},t.prototype.calc=function(t,e,n){var o=p(t.split(""),2),i=o[0],r=o[1],s={};return"t"===i&&(s.top=this.config.offset),"b"===i&&(s.bottom=this.config.offset),"l"!==i&&"r"!==i&&"c"!==i||r||(s.top=(e.height-n.height)/2),"t"!==i&&"b"!==i&&"c"!==i||r||(s.left=(e.width-n.width)/2),("l"===i&&!r||"l"===r)&&(s.left=this.config.offset),("r"===i&&!r||"r"===r)&&(s.right=this.config.offset),s},t}(f),T=function(n){function t(t){var e=n.call(this)||this;return e.config={src:null,placement:h.TOP,autoUpdate:!1,width:"auto",height:"auto"},e.updateConfig(t),e}return c(t,n),t.prototype.init=function(t){this.config.autoUpdate&&this.listenDrag(t)},t.prototype.getPositions=function(t){var e=this.getCoords(this.config.src),n=this.getCoords(t),o=this.config,i=o.width,r=o.height;i=w(e,n,"width",i),r=w(e,n,"height",r);var s=this.calculatePos(this.config.placement,e,n),c=s.pos,p=s.props;return a({},this.round(p),{width:i,height:r,extra:c})},t.prototype.getCoords=function(t){return t.getBoundingClientRect()},t.prototype.calc=function(t,e,n){var o=p(t.split(""),2),i=o[0],r=o[1],s={left:0,top:0};return"t"!==i&&"b"!==i||r||(s.left=e.left+(e.width-n.width)/2),"t"!==i&&"b"!==i||!r||(s.left=e.left),"t"!==i&&"b"!==i||"r"!==r||(s.left=e.left+e.width-n.width),"l"===i&&(s.left=e.left-n.width),"r"===i&&(s.left=e.right),"t"===i&&(s.top=e.top-n.height),"b"===i&&(s.top=e.top+e.height),"l"!==i&&"r"!==i||(s.top=e.top+(e.height-n.height)/2),"t"!==r||"l"!==i&&"r"!==i||(s.top=e.top),"b"!==r||"l"!==i&&"r"!==i||(s.top=e.top+e.height-n.height),s},t.prototype.calculatePos=function(t,e,n,o){void 0===o&&(o=!0);var i=this.calc(t,e,n);return o&&this.config.autoUpdate&&this.isOverflowed(a({},i,{width:n.width,height:n.height}))?this.calculatePos(this.nextPosition(t),e,n,!1):{pos:t,props:i}},t.prototype.isOverflowed=function(t){var e=window.innerHeight,n=window.innerWidth;return t.bottom=t.top+t.height,t.right=t.left+t.width,t.bottom>e||t.top<=0||t.left<=0||t.right>n},t.prototype.nextPosition=function(t){var e=["t","b","l","r","tl","bl","tr","br","lt","rt","lb","rb"],n=e.indexOf(t);return n%2==0?e[n+1]:e[n-1]},t.prototype.round=function(e){return Object.keys(e).forEach(function(t){return e[t]=Math.round(e[t])}),e},t.prototype.listenDrag=function(c){this.obs&&this.obs.disconnect(),this.obs=new MutationObserver(function(t){var e,n;try{for(var o=function r(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}(t),i=o.next();!i.done;i=o.next()){"attributes"===i.value.type&&C.send(c,"t_dynpos")}}catch(s){e={error:s}}finally{try{i&&!i.done&&(n=o["return"])&&n.call(o)}finally{if(e)throw e.error}}}),this.obs.observe(this.config.src,{attributeFilter:["style"]})},t}(f),x=function(n){function t(t){var e=n.call(this)||this;return e.config={placement:u.LEFT,width:"30%"},e.config=a({},e.config,t),e}return c(t,n),t.prototype.getPositions=function(){var t=this.config.placement===u.LEFT?{left:0}:{right:0};return a({},t,{top:0,width:this.config.width,height:"100%",position:"fixed",extra:this.config.placement})},t}(f),j={containerClass:"t-overlay",bodyClass:"t-open",wrapperClass:"",backdropClass:"",backdrop:!1,closeOnDocClick:!1,listenWindowEvents:!0,closeOnEsc:!1,windowResizeCallback:function(){},docClickCallback:function(){}},E=function(){function t(t,e,n,o){this.inj=t,this.cd=e,this.compResolver=n,this.elRef=o,this.content={type:"s",data:"",props:{}},this.die=new r.Subject,this.pinj=i.Injector}return t.prototype.ngOnInit=function(){this.el=this.elRef.nativeElement,this.wrapperEl=this.el.querySelector(".t-wrapper");var t=["t-container",this.config.containerClass,this.position.getClassName()];this.config.closeOnDocClick&&(t=t.concat(["no-pointers"])),this.el.setAttribute("data-tid",this.tid),v("add",t,"[data-tid='"+[this.tid]+"']"),v("add",[this.config.bodyClass])},t.prototype.ngAfterViewInit=function(){this.listenPos().subscribe(),"c"===this.content.type&&(this.compInstance=this.setComponent(this.content.props),C.send(this.tid,"t_compins",this.compInstance))},t.prototype.setComponent=function(t){var e=this.compOutlet.createComponent(this.compResolver.resolveComponentFactory(this.content.data));return Object.assign(e.instance,t),e.changeDetectorRef.detectChanges(),e.instance},t.prototype.updateTextContent=function(t){"s"===this.content.type&&(this.content.data=t,this.cd.detectChanges())},t.prototype.ngOnDestroy=function(){v("remove",[this.config.bodyClass]),this.die.next(1),C.send(this.tid,"t_detach")},t.prototype.listenPos=function(){var n=this;return C.listen(this.tid,"t_dynpos").pipe(o.startWith(1),o.takeUntil(this.die),o.tap(function(t){if(!t||!t.x)return n.setPos();var e={left:t.x,top:t.y};n.wrapperEl.style=m(e)}))},t.prototype.setPos=function(){var t=this.position.getPositions(this.wrapperEl),e=t.extra,n=function r(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(t);i<o.length;i++)e.indexOf(o[i])<0&&(n[o[i]]=t[o[i]])}return n}(t,["extra"]);this.extra!==e&&(this.extra=e,this.cd.detectChanges()),Object.assign(n,{visibility:"visible",opacity:"1"}),this.wrapperEl.style=m(n),C.send(this.tid,"t_posupdate")},t.decorators=[{type:i.Component,args:[{selector:"toppy",template:'<div class="t-backdrop" *ngIf="config.backdrop" [ngClass]="config.backdropClass"></div>\n<div class="t-wrapper" [ngClass]="config.wrapperClass" [class]="extra" #wrapperEl>\n  <ng-container [ngSwitch]="content.type">\n    <ng-container *ngSwitchCase="\'s\'">\n      <div [class]="content.props.class">{{ content.data }}</div>\n    </ng-container>\n    <ng-container *ngSwitchCase="\'h\'"> <div [innerHTML]="content.data"></div> </ng-container>\n    <ng-container *ngSwitchCase="\'t\'">\n      <ng-container *ngTemplateOutlet="content.data; context: { $implicit: content.props }"></ng-container>\n    </ng-container>\n    <ng-container *ngSwitchCase="\'c\'"> <ng-template #compOutlet></ng-template> </ng-container>\n  </ng-container>\n</div>\n',changeDetection:i.ChangeDetectionStrategy.OnPush,styles:[":host{left:0;position:fixed;top:0;width:100%;height:100%;pointer-events:none}:host.no-pointers{pointer-events:all}:host .t-backdrop{left:0;position:fixed;top:0;width:100%;height:100%;background:rgba(0,0,0,.5)}:host>div.t-wrapper{position:absolute;visibility:hidden;opacity:0;transition:opacity .2s;overflow:hidden;pointer-events:all}"]}]}],t.ctorParameters=function(){return[{type:i.Injector},{type:i.ChangeDetectorRef},{type:i.ComponentFactoryResolver},{type:i.ElementRef}]},t.propDecorators={compOutlet:[{type:i.ViewChild,args:["compOutlet",{read:i.ViewContainerRef}]}]},t}(),P=function(){function t(t,e,n){var o=this;this.appRef=t,this.compResolver=e,this.injector=n,this.updateTextContent=new r.Subject,this.isOpen=!1,this.die=new r.Subject,this.updateTextContent.subscribe(function(t){o.isOpen&&o.comp.updateTextContent(t)})}return t.prototype.open=function(){var t=this;this.isOpen||(this.attach(),this.viewEl&&(r.merge(this.onDocumentClick(),this.onWindowResize(),this.onEscClick()).subscribe(),setTimeout(function(){return C.send(t.tid,"t_dynpos")},1)),C.send(this.tid,"t_open"),this.isOpen=!0)},t.prototype.close=function(){this.isOpen&&(this.dettach(),this.die.next(1),C.send(this.tid,"t_close"),this.isOpen=!1)},t.prototype.toggle=function(){return this.isOpen?this.close():this.open()},t.prototype.onEscClick=function(){var t=this;return r.fromEvent(b,"keydown").pipe(o.takeUntil(this.die),o.skipWhile(function(){return!t.config.closeOnEsc}),o.filter(function(t){return("Escape"===t.key||"Esc"===t.key||27===t.keyCode)&&"BODY"===t.target.nodeName}),o.tap(function(t){return t.preventDefault()}),o.map(function(t){return t.target}),o.tap(function(){return t.close()}))},t.prototype.onDocumentClick=function(){var t=this;return r.fromEvent(this.viewEl,"click").pipe(o.takeUntil(this.die),o.map(function(t){return t.target}),o.skipWhile(function(){return!t.config.closeOnDocClick}),o.filter(this.isNotHostElement.bind(this)),o.tap(function(){t.config.docClickCallback(),t.close()}))},t.prototype.onWindowResize=function(){var t=this,e=r.fromEvent(window,"resize"),n=r.fromEvent(window,"scroll",{passive:!0});return r.merge(e,n).pipe(o.skipWhile(function(){return!t.config.listenWindowEvents}),o.takeUntil(this.die),o.debounceTime(5),o.observeOn(r.animationFrameScheduler),o.distinctUntilChanged(),o.tap(function(){C.send(t.tid,"t_dynpos"),t.config.windowResizeCallback()}))},t.prototype.changePosition=function(t){this.position=t},t.prototype.updatePosition=function(t){this.position.updateConfig(t)},t.prototype.updateContent=function(t,e){void 0===e&&(e={}),this.content=g(t,a({},this.content.props,e))},t.prototype.listen=function(t){return C.listen(this.tid,t)},t.prototype.isNotHostElement=function(t){var e=this.viewEl.querySelector(".t-wrapper");return t!==e&&!e.contains(t)},t.prototype.attach=function(){this.compFac=this.compResolver.resolveComponentFactory(E),this.compRef=this.compFac.create(this.injector),this.comp=this.compRef.instance;var t=this.position,e=this.content,n=this.config,o=this.tid;e.props.close=this.close.bind(this),Object.assign(this.comp,{position:t,content:e,config:n,tid:o}),this.hostView=this.compRef.hostView,this.appRef.attachView(this.hostView),this.viewEl=this.hostView.rootNodes[0],b.appendChild(this.viewEl)},t.prototype.dettach=function(){this.hostView&&(this.appRef.detachView(this.hostView),this.compRef.destroy(),this.hostView=this.viewEl=this.comp=null)},t}(),R=function(){function n(t){this.injector=t,this.inputs={position:null,config:j,content:{type:"s",data:"hello",props:{}},tid:null},this.inputs.position=new O({placement:l.TOP})}return n.prototype.position=function(t){return this.inputs.position=t,this},n.prototype.config=function(t){return this.inputs.config=a({},j,t),this},n.prototype.content=function(t,e){return void 0===e&&(e={}),this.inputs.content=g(t,e),this},n.prototype.create=function(t){void 0===t&&(t=null),this.tid=this.inputs.tid=t||y();var e=i.Injector.create([{provide:P,deps:[i.ApplicationRef,i.ComponentFactoryResolver,i.Injector]}],this.injector).get(P);return n.controls[this.tid]&&(this.tid=y()),this.inputs.position.init(this.tid),n.controls[this.tid]=Object.assign(e,this.inputs),e},n.prototype.getCtrl=function(t){return n.controls[t]},n.prototype.destroy=function(){for(var t in n.controls)n.controls[t].close();n.controls={},C.stop()},n.controls={},n.decorators=[{type:i.Injectable,args:[{providedIn:"root"}]}],n.ctorParameters=function(){return[{type:i.Injector}]},n.ngInjectableDef=i.defineInjectable({factory:function(){return new n(i.inject(i.INJECTOR))},token:n,providedIn:"root"}),n}(),k=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule],declarations:[E],entryComponents:[E]}]}],t}();t.InsidePlacement=l,t.OutsidePlacement=h,t.SlidePlacement=u,t.FullscreenPosition=d,t.GlobalPosition=O,t.RelativePosition=T,t.SlidePosition=x,t.Toppy=R,t.ToppyControl=P,t.ToppyModule=k,t.ɵa=E,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=toppy.umd.min.js.map